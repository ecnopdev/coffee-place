<script>
    var mainApp = new Vue({ 
        el:"#app", 
        data: {
            testMessage:"Hello World",
            orderList:[],
            servingSlot1:null,
            servingSlot2:null,
            showSnackBar:false,
            snackBarText:"All hands are full..",
            firebaseConfig : {
                apiKey: "AIzaSyApK1G61oVD_sUaNfiIFmEh43eM2Gaoyow",
                authDomain: "coffee-shop-638ff.firebaseapp.com",
                databaseURL: "https://coffee-shop-638ff.firebaseio.com",
                projectId: "coffee-shop-638ff",
                storageBucket: "coffee-shop-638ff.appspot.com",
                messagingSenderId: "562451150203",
                appId: "1:562451150203:web:c9f97a8f46dd59bb"
            },
            firebaseDb : {},
        },
        created: function(){
            // Initialize Firebase
             this.firebaseDb = firebase.initializeApp(this.firebaseConfig);          
        },
        mounted: function(){
            this.getPendingOrders().then(results =>{
                this.orderList = results;
            });
        },
        methods: {
            helloVue(){
                alert("hello vueue");
            },
            getPendingOrders(){
                return this.firebaseDb.database().ref("/new").once("value").then(snapshot => {
                    var results = snapshot.val();
                    var currentOrderList = [];
                    for(var key in results){
                        var orderListEntry = results[key];
                        orderListEntry.spaceId = key;
                        currentOrderList.push(orderListEntry);
                    }
                    return currentOrderList;
                });
            },
            serveOrder(curOrder){

                if(this.servingSlot1 === null){
                    this.servingSlot1 = curOrder;
                }else if(this.servingSlot2 === null){
                    this.servingSlot2 = curOrder;    
                }else{
                    this.showSnackBar = true;
                }

                this.sendMessageToCustomer(curOrder.spaceId,"Please proceed to the coffee booth to get yout drink. Thank you.");
            },
            completeOrder(slotNum,spaceId){
                this.sendMessageToCustomer(this["servingSlot"+slotNum].spaceId,"Enjoy your drink. Please give us some feedback through this link.");
                this["servingSlot"+slotNum] = null;
            },
            sendMessageToCustomer(spaceId,message){
                google.script.run
                .withSuccessHandler(function(response){})
                .withFailureHandler(function(error){})
                .sendMessageToUser(spaceId,message);
            }
        }
    });
</script>    
